# 场景的加载

* ==使用的场景叠加的方式切换场景==

* 创建一个TransitionManager的文件管理场景的切换，挂载到Persisten场景中的TransitionManager的物体上

* 需要头文件UnityEngine.SceneManagement

* 先将初始场景设为空

* ```c#
  public string startSceneName = string.Empty;
  ```

* 使用携程实现异步加载，通过场景在名字控制指定的场景

* ```c#
      private IEnumerator Transition(string sceneName, Vector3 targetPosition)
      {
          yield return SceneManager.UnloadSceneAsync(SceneManager.GetActiveScene());//使用异步加载的方式获得当前场景的名字来卸载当前场景
  
          yield return LoadSceneSetActive(sceneName);//携程中调用携程不用StartCoroutine，加载目标场景
      }
  ```

* 

* ```c#
      private IEnumerator LoadSceneSetActive(string sceneName)//使用携程加载场景
      {
          yield return SceneManager.LoadSceneAsync(sceneName, LoadSceneMode.Additive);//使用异步加载通过场景的名字加载场景，此处yield return作用为暂停携程执行等待异步加载完成
          Scene newScene = SceneManager.GetSceneAt(SceneManager.sceneCount - 1);//SceneManager.GetSceneAt（index）通过索引获得目标场景，获得当前加载的场景数量
          SceneManager.SetActiveScene(newScene);//将目标场景设置为活动场景
      }
  ```

* ==场景加载一些组件需要更改可以使用事件的方式，加载前执行事件，加载后执行事件==

* ==场景控制的函数==：

  * ```c#
    SceneManager.GetActiveScene().name//获得当前场景的名字
    
        
    SceneManager.UnloadSceneAsync(SceneManager.GetActiveScene());//使用异步加载的方式卸载当前场景
    
    SceneManager.GetSceneAt(index)；//根据当前激活的场景的索引查找场景，从0开始
    ```

  * 当前激活的场景的索引为Hierarchy窗口中激活的场景![image-20230628201439527](https://raw.githubusercontent.com/LuoYangSunTian/Image/main/Img/image-20230628201439527.png)